import json

# path to your manifest
manifest_path = "platform.json"

with open(manifest_path, "r") as f:
    manifest = json.load(f)

project_id = manifest.get("project_id", "unknown")
apisix_modules = manifest.get("modules", [])

print(f"Project ID: {project_id}")
print(f"Found {len(apisix_modules)} modules")


global_plugins = {}

for apisix_module in apisix_modules:
    config = apisix_module.get("config", {})
    for plugin in config.get("global_plugins", []):
        if plugin.get("enabled", True):
            global_plugins[plugin["name"]] = plugin.get("config", {})

print("=== Extracted Global Plugins ===")
print(json.dumps(global_plugins, indent=2))
